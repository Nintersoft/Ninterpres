//---------------------------------------------------------------------------

#include <fmx.h>
#pragma hdrstop

#include "ImgConf.h"
#include "Principal.h"
#include "Codigo.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.fmx"
TfrmImgConf *frmImgConf;
//---------------------------------------------------------------------------
	int dd;
//---------------------------------------------------------------------------
__fastcall TfrmImgConf::TfrmImgConf(TComponent* Owner)
	: TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TfrmImgConf::btSalvarClick(TObject *Sender)
{
	if (edtImgLeg->Text == "") {
		frmPrincipal->lblImgLeg->Text = "(Legenda da imagem)";
		frmPrincipal->lblImgLeg->Visible = false;
		frmImgConf->Close();
	}
	else {
		frmPrincipal->lblImgLeg->Text = edtImgLeg->Text;
		frmPrincipal->lblImgLeg->Visible = true;
		if (dd == 0) {
			int loc, pos = 0, tam = frmCodigo->mmCodigo->Lines->Count;
			for (int i = 0; i < tam; i++) {
				if (frmCodigo->mmCodigo->Lines->Strings[i] == "$CAPA") {
					loc = i +1;
					i = tam;
				}
			}
			do {
				while (comentario(frmCodigo->mmCodigo->Lines->Strings[loc])){
					loc++;
				}
				if (pos == 0) {
					loc++;
					pos++;
				}
				else if (pos == 1) {
					frmCodigo->mmCodigo->Lines->Strings[loc] = edtImgLeg->Text;
					loc++;
				}
				else {
					loc++;
                }
			} while (frmCodigo->mmCodigo->Lines->Strings[loc] != "!(FDT)")

		}
		frmImgConf->Close();
	}

}
//---------------------------------------------------------------------------
void TfrmImgConf::CarregarDadosVar (int transp)
{
	dd = transp;
}
//---------------------------------------------------------------------------
